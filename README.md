# AIGC_Frontend

一个视频生成软件的安卓前端。   

软件功能的大致描述：使用该软件，用户可以自主上传图片、文字等基础素材，软件会将这些基础素材综合在一起，计算出一个符合用户预期的生成素材（可以是图片、物体模型等），并将该生成素材插入到某个视频中用户期望的地方，使之成为视频的一部分。   

前端包括以下几个功能：视频选择、视频区间选择、插入区域选择、图片和文字等基本素材的上传、生成素材的展示和选择、生成视频的展示和保存、与后端通信（REST）。
前端效果截图：   

![image](https://github.com/qwq-y/ADS_Application/assets/94696811/bbdd1619-c9d3-4811-bc7f-e75980cf4092)
![image](https://github.com/qwq-y/ADS_Application/assets/94696811/fc803c36-51d9-41d3-b9e0-44d633467c99)
![image](https://github.com/qwq-y/ADS_Application/assets/94696811/0cfbec01-8f68-4bb2-a6da-7fe1ab8afe51)
![image](https://github.com/qwq-y/ADS_Application/assets/94696811/a99864ce-f3f8-4ae6-ae71-7b0c2d336f8b)

# Plane Insertion 的前端通信

前端使用 OkHttp3 与后端进行 RESTful 风格的通信。   

前端在给后端发送请求时，统一使用 **JSON 形式的字符串参数**，和 **多部分表单形式的图片列表、视频列表**。其中，后端接收到的图片和视频均为二进制数据，可直接作为有效的图片、视频文件处理。后端可以通过 'image' 关键字获取上传的图片列表，通过 'video' 关键字获取上传的视频列表，然后在列表中依据顺序处理。

前端在接收后端回复时，总共可以接收 4 个字段的数据：

- 'Status'：状态码   
- 'Message'：反馈消息（报错信息等）   
- 'VideoBytes'：base64 编码的视频     
- 'Content'：base64 编码的图片的列表       

前后端总共有两次交互：获取掩码、（用户确认掩码合适后）获取生成结果。以下是这两次通信分别的收发内容。

## 一、获取掩码

### 前端发送请求：   

前端发送的请求包括使用 JSON 字符串形式上传的轨迹数据，和使用多部分表单形式上传的两张图片。JSON 形式的轨迹数据示例如下：

    {
    "pointsJsonStr": "[{\"x\":1,\"y\":2,\"isLongPress\":1}, {\"x\":3,\"y\":4,\"isLongPress\":0}]"
    }

后端接收后可以通过 'pointsJsonStr' 关键字获取轨迹数据，然后转化为点数据的列表。（x 和 y 表述点的像素坐标；isLongPress 为 1 表示用户长按，为 0 表示用户短按。）   

图片数据包含 **不带掩码的第一帧的图片** 和 **当前掩码图片（如果存在的话）**。

### 前端接收回复：

前端会处理前面提到的 4 个字段中的：状态码、反馈消息、base64 编码的图片的列表。其中，图片列表包含两张图片：第一张是包含掩码的的第一帧图像（用于展示给用户），第二张是单独的掩码图片（用于下一次发送给后端）。   

## 二、获取生成结果

### 前端发送请求：   

前端发送的请求包括使用 JSON 字符串形式上传的视频起止时间，和使用多部分表单形式上传的图片、视频。JSON 形式的视频起止时间示例如下（单位为毫秒）：

    {
    "startMillis": "12345",
    "endMillis": "23456"
    }

图片数据包含 **不带掩码的第一帧的图片** 和 **掩码图片**；视频包含 **原视频** 和 **准备插入的广告视频**。

### 前端接收回复：

前端会处理前面提到的 4 个字段中的：状态码、反馈消息、base64 编码的视频。该视频即为后端生成的结果。
